<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta charset="utf-8">
  <title>Convolution Arithmetic in  Deep Learning Part 2</title>

  <meta name="author" content="Nrupatunga" />
  <meta name="description" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <link rel="alternate" type="application/rss+xml" href="/atom.xml" />

  <link href="/vendor/css/bootstrap.min.css" rel="stylesheet">
  <link href="/vendor/css/font-awesome.min.css" rel="stylesheet">
  <link href="/vendor/css/academicons.min.css" rel="stylesheet">
  <link href="/vendor/pygments/default.css" rel="stylesheet">
  <link href="/css/bamos.css" rel="stylesheet">
  <link href="/css/sharingbuttons.css" rel="stylesheet">

  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
	<div class="navbar navbar-default navbar-fixed-top">
		<div class="container">
			<div class="row">
				<div class="col-md-10 col-md-offset-1">
					<div class="navbar-header">
						  <a href="/" class="navbar-brand">
                  <div>
                      <img src="/images/me-circle.jpg" class="img-circle"></img>
		      Nrupatunga
                  </div>
              </a>
						<button class="navbar-toggle" type="button" data-toggle="collapse"
                    data-target="#navbar-main">
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
					</div>
					<div class="navbar-collapse collapse" id="navbar-main">
						<ul class="nav navbar-nav">
							<li>
								<a href="/">About</a>
							</li>
							<li>
								<a href="/blog/">Posts</a>
							</li>
							<li>
								<a href="/project/">Project</a>
							</li>
						</ul>
						<ul class="nav navbar-nav navbar-right" style="font-size: 1.5em">
							<li>
								<a href="https://nrupatunga.github.io/cv/nrupatunga-resume.pdf" target="_blank">
									<i class="fa fa-cloud-download"></i></a>
							</li>
							<li>
								<a href="http://github.com/Nrupatunga" target="_blank">
									<i class="fa fa-github"></i></a>
							</li>
							<li>
								<a href="https://in.linkedin.com/in/nrupatunga" target="_blank">
									<i class="fa fa-linkedin"></i></a>
							</li>
							
								
									
							
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>

  <br/>
<div class="container">
<div class="row">
<div class="col-md-10 col-md-offset-1">
  <h1>Convolution Arithmetic in  Deep Learning Part 2</h1>
<em>May 14, 2016</em>
<br>

<!-- From: http://sharingbuttons.io/ -->

<!-- Sharingbutton Twitter -->
<a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=Convolution Arithmetic in  Deep Learning Part 2 by @brandondamos &amp;url=http://nrupatunga.github.io/convolution-2/" target="_blank" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
        <g>
            <path d="M23.444,4.834c-0.814,0.363-1.5,0.375-2.228,0.016c0.938-0.562,0.981-0.957,1.32-2.019c-0.878,0.521-1.851,0.9-2.886,1.104 C18.823,3.053,17.642,2.5,16.335,2.5c-2.51,0-4.544,2.036-4.544,4.544c0,0.356,0.04,0.703,0.117,1.036 C8.132,7.891,4.783,6.082,2.542,3.332C2.151,4.003,1.927,4.784,1.927,5.617c0,1.577,0.803,2.967,2.021,3.782 C3.203,9.375,2.503,9.171,1.891,8.831C1.89,8.85,1.89,8.868,1.89,8.888c0,2.202,1.566,4.038,3.646,4.456 c-0.666,0.181-1.368,0.209-2.053,0.079c0.579,1.804,2.257,3.118,4.245,3.155C5.783,18.102,3.372,18.737,1,18.459 C3.012,19.748,5.399,20.5,7.966,20.5c8.358,0,12.928-6.924,12.928-12.929c0-0.198-0.003-0.393-0.012-0.588 C21.769,6.343,22.835,5.746,23.444,4.834z"/>
        </g>
    </svg>
    </div>
  </div>
</a>

<!-- Sharingbutton Facebook -->
<a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=http://nrupatunga.github.io/convolution-2/" target="_blank" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
        <g>
            <path d="M18.768,7.465H14.5V5.56c0-0.896,0.594-1.105,1.012-1.105s2.988,0,2.988,0V0.513L14.171,0.5C10.244,0.5,9.5,3.438,9.5,5.32 v2.145h-3v4h3c0,5.212,0,12,0,12h5c0,0,0-6.85,0-12h3.851L18.768,7.465z"/>
        </g>
    </svg>
    </div>
  </div>
</a>

<!-- Sharingbutton Google+ -->
<a class="resp-sharing-button__link" href="https://plus.google.com/share?url=http://nrupatunga.github.io/convolution-2/" target="_blank" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--google resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
        <g>
            <path d="M11.366,12.928c-0.729-0.516-1.393-1.273-1.404-1.505c0-0.425,0.038-0.627,0.988-1.368 c1.229-0.962,1.906-2.228,1.906-3.564c0-1.212-0.37-2.289-1.001-3.044h0.488c0.102,0,0.2-0.033,0.282-0.091l1.364-0.989 c0.169-0.121,0.24-0.338,0.176-0.536C14.102,1.635,13.918,1.5,13.709,1.5H7.608c-0.667,0-1.345,0.118-2.011,0.347 c-2.225,0.766-3.778,2.66-3.778,4.605c0,2.755,2.134,4.845,4.987,4.91c-0.056,0.22-0.084,0.434-0.084,0.645 c0,0.425,0.108,0.827,0.33,1.216c-0.026,0-0.051,0-0.079,0c-2.72,0-5.175,1.334-6.107,3.32C0.623,17.06,0.5,17.582,0.5,18.098 c0,0.501,0.129,0.984,0.382,1.438c0.585,1.046,1.843,1.861,3.544,2.289c0.877,0.223,1.82,0.335,2.8,0.335 c0.88,0,1.718-0.114,2.494-0.338c2.419-0.702,3.981-2.482,3.981-4.538C13.701,15.312,13.068,14.132,11.366,12.928z M3.66,17.443 c0-1.435,1.823-2.693,3.899-2.693h0.057c0.451,0.005,0.892,0.072,1.309,0.2c0.142,0.098,0.28,0.192,0.412,0.282 c0.962,0.656,1.597,1.088,1.774,1.783c0.041,0.175,0.063,0.35,0.063,0.519c0,1.787-1.333,2.693-3.961,2.693 C5.221,20.225,3.66,19.002,3.66,17.443z M5.551,3.89c0.324-0.371,0.75-0.566,1.227-0.566l0.055,0 c1.349,0.041,2.639,1.543,2.876,3.349c0.133,1.013-0.092,1.964-0.601,2.544C8.782,9.589,8.363,9.783,7.866,9.783H7.865H7.844 c-1.321-0.04-2.639-1.6-2.875-3.405C4.836,5.37,5.049,4.462,5.551,3.89z"/>
            <polygon points="23.5,9.5 20.5,9.5 20.5,6.5 18.5,6.5 18.5,9.5 15.5,9.5 15.5,11.5 18.5,11.5 18.5,14.5 20.5,14.5 20.5,11.5  23.5,11.5 	"/>
        </g>
    </svg>
    </div>
  </div>
</a>

<!-- Sharingbutton LinkedIn -->
<a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://nrupatunga.github.io/convolution-2/&amp;title=Convolution Arithmetic in  Deep Learning Part 2&amp;summary=Convolution Arithmetic in  Deep Learning Part 2&amp;source=http://nrupatunga.github.io/convolution-2/" target="_blank" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
        <g>
            <path d="M6.527,21.5h-5v-13h5V21.5z M4.018,6.5H3.988C2.478,6.5,1.5,5.318,1.5,4.019c0-1.329,1.008-2.412,2.547-2.412 c1.541,0,2.488,1.118,2.519,2.447C6.565,5.354,5.588,6.5,4.018,6.5z M15.527,12.5c-1.105,0-2,0.896-2,2v7h-5c0,0,0.059-12,0-13h5 v1.485c0,0,1.548-1.443,3.938-1.443c2.962,0,5.062,2.144,5.062,6.304V21.5h-5v-7C17.527,13.396,16.632,12.5,15.527,12.5z"/>
        </g>
    </svg>
    </div>
  </div>
</a>

<!-- Sharingbutton Reddit -->
<a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=http://nrupatunga.github.io/convolution-2/" target="_blank" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
        <path d="M24,11.5c0-1.654-1.346-3-3-3c-0.964,0-1.863,0.476-2.422,1.241c-1.639-1.006-3.747-1.64-6.064-1.723 c0.064-1.11,0.4-3.049,1.508-3.686c0.72-0.414,1.733-0.249,3.01,0.478C17.189,6.317,18.452,7.5,20,7.5c1.654,0,3-1.346,3-3 s-1.346-3-3-3c-1.382,0-2.536,0.944-2.883,2.217C15.688,3,14.479,2.915,13.521,3.466c-1.642,0.945-1.951,3.477-2.008,4.551 C9.186,8.096,7.067,8.731,5.422,9.741C4.863,8.976,3.964,8.5,3,8.5c-1.654,0-3,1.346-3,3c0,1.319,0.836,2.443,2.047,2.844 C2.019,14.56,2,14.778,2,15c0,3.86,4.486,7,10,7s10-3.14,10-7c0-0.222-0.019-0.441-0.048-0.658C23.148,13.938,24,12.795,24,11.5z  M2.286,13.366C1.522,13.077,1,12.351,1,11.5c0-1.103,0.897-2,2-2c0.635,0,1.217,0.318,1.59,0.816 C3.488,11.17,2.683,12.211,2.286,13.366z M6,13.5c0-1.103,0.897-2,2-2s2,0.897,2,2c0,1.103-0.897,2-2,2S6,14.603,6,13.5z  M15.787,18.314c-1.063,0.612-2.407,0.949-3.787,0.949c-1.387,0-2.737-0.34-3.803-0.958c-0.239-0.139-0.321-0.444-0.182-0.683 c0.139-0.24,0.444-0.322,0.683-0.182c1.828,1.059,4.758,1.062,6.59,0.008c0.239-0.138,0.545-0.055,0.683,0.184 C16.108,17.871,16.026,18.177,15.787,18.314z M16,15.5c-1.103,0-2-0.897-2-2c0-1.103,0.897-2,2-2s2,0.897,2,2 C18,14.603,17.103,15.5,16,15.5z M21.713,13.365c-0.397-1.155-1.201-2.195-2.303-3.048C19.784,9.818,20.366,9.5,21,9.5 c1.103,0,2,0.897,2,2C23,12.335,22.468,13.073,21.713,13.365z"/>
    </svg>
    </div>
  </div>
</a>

<!-- Sharingbutton E-Mail -->
<a class="resp-sharing-button__link" href="mailto:?subject=Convolution Arithmetic in  Deep Learning Part 2&amp;body=http://nrupatunga.github.io/convolution-2/" target="_self" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
        <path d="M22,4H2C0.897,4,0,4.897,0,6v12c0,1.103,0.897,2,2,2h20c1.103,0,2-0.897,2-2V6C24,4.897,23.103,4,22,4z M7.248,14.434 l-3.5,2C3.67,16.479,3.584,16.5,3.5,16.5c-0.174,0-0.342-0.09-0.435-0.252c-0.137-0.239-0.054-0.545,0.186-0.682l3.5-2 c0.24-0.137,0.545-0.054,0.682,0.186C7.571,13.992,7.488,14.297,7.248,14.434z M12,14.5c-0.094,0-0.189-0.026-0.271-0.08l-8.5-5.5 C2.997,8.77,2.93,8.46,3.081,8.229c0.15-0.23,0.459-0.298,0.691-0.147L12,13.405l8.229-5.324c0.232-0.15,0.542-0.084,0.691,0.147 c0.15,0.232,0.083,0.542-0.148,0.691l-8.5,5.5C12.189,14.474,12.095,14.5,12,14.5z M20.934,16.248 C20.842,16.41,20.673,16.5,20.5,16.5c-0.084,0-0.169-0.021-0.248-0.065l-3.5-2c-0.24-0.137-0.323-0.442-0.186-0.682 s0.443-0.322,0.682-0.186l3.5,2C20.988,15.703,21.071,16.009,20.934,16.248z"/>
    </svg>
    </div>
  </div>
</a>


<hr style="margin-top: 0;">

<p>Table of Contents:</p>

<ul>
  <li><a href="#L1">Recap from Part 1</a></li>
  <li><a href="#L2">Pooling</a></li>
  <li><a href="#L3">Deconvolution</a></li>
  <li><a href="#L4">Deconvolution Arithmetic</a>
    <ul>
      <li><a href="#L41">No Zero Padding, Unit Strides, Transposed</a></li>
      <li><a href="#L42">Zero Padding, Unit Strides, Transposed</a></li>
      <li><a href="#L43">Half Padding, Transposed</a></li>
      <li><a href="#L44">Full Padding, Transposed</a></li>
      <li><a href="#L45">No Zero Padding, Non-Unit Strides, Transposed</a></li>
      <li><a href="#L46">Zero Padding, Non-Unit Strides, Transposed</a></li>
    </ul>
  </li>
  <li><a href="#L5">Take Away </a></li>
  <li><a href="#LR">References</a></li>
</ul>

<p><a name="L1"></a>
## Recap from Part 1</p>

<p>In Part 1, we reviewed the convolution operation and understood how output of convolution is affected by the 
choice of parameters such as <em>kernel size, strides</em>, and <em>padding</em>.  We saw the effect of <em>strides</em> and 
<em>padding</em> on output of the convolution individually and together.</p>

<p>At last we came up with a general formula for output of the convolution and its dependency on these parameters.
Please remember the below relationship</p>

<p><strong>Relationship</strong>: For any \(i\), \(k\), \(s\), and \(p\) 
<script type="math/tex">o = \lfloor \dfrac{i + 2p - k}{s} \rfloor + 1</script>
where \( i \) : input size, \( k \) : kernel size, \( s \) : stride, \( p \) : zero padding, \(\lfloor \rfloor\): floor operation, \(o\) : output size</p>

<div class="image-wrapper">

  <p><a href="../assets/arbitrary_padding_strides-1.PNG" title="" target="_blank"></a></p>

  <p><img src="" alt="" /></p>

  <p>&lt;/a&gt;</p>

</div>

<ul>
  <li>Figure 2.1  provides an example for \(i = 5\), \(k = 3\), \(s = 2\) and \(p = 1\),
  therefore output size \(o = \lfloor \dfrac{5 + 2*1 - 3}{2} \rfloor + 1 = 5\).</li>
</ul>

<p>Now that we know how these parameters play a role in convolution, let us understand the same in pooling and deconvolution arithmetic</p>

<p><a name="L2"></a>
## Pooling</p>

<p>Pooling operation provide invariance to small translations of the input (think in terms of image). Different kinds of pooling
functions are known namely <em>max-pooling</em> and <em>average pooling</em>. Pooling does not involves zero padding in neural network. 
So, we can rewrite the formula described in the above section by eliminating the padding term \(p\) as
G
<script type="math/tex">o = \lfloor \dfrac{i - k}{s} \rfloor + 1</script></p>

<p>This relationship holds good for any kind of pooling</p>

<p><a name="L3"></a>
## Deconvolution
Deconvolution is nothing but transpose of convolution. It is also called as <strong><em>Transposed Convolution</em></strong>.</p>

<div class="image-wrapper">

  <p><a href="../assets/no_padding_no_strides.png" title="" target="_blank"></a></p>

  <p><img src="" alt="" /></p>

  <p>&lt;/a&gt;</p>

</div>

<p>Lets take an example of convolution represented in Figure 2.2 to understand what I meant. If we unroll the input and output into vectors from left to right and top to bottom,
we can represent the output by the multiplication of input with sparse matrix \(C\), where the non-zero elements are the elements \(w_{i, j}\) 
of the kernel (\(i\) : row and \(j\) : column). This is showin in Figure 2.3</p>

<div class="image-wrapper">

  <p><a href="../assets/convolution/deconvolution-unroll.jpg" title="" target="_blank"></a></p>

  <p><img src="" alt="" /></p>

  <p>&lt;/a&gt;</p>

</div>

<ul>
  <li>As shown in the figure, matrix multiplication form takes the input matrix flattened as a \(16\)-dimensional vector and produces a \(4\)-dimensional 
vector. Therefore convolution maps the input vector from \(16\)-dimensional space to \(4\)-dimensional space.</li>
  <li>In order to map back the \(4\)-dimensional space to \(16\)-dimensional space, we multiply the output with \(C^T\). Hence the name <strong><em>Transposed Convolution</em></strong> for 
<strong><em>Deconvolution</em></strong>. This is shown in Figure 2.4.</li>
</ul>

<div class="image-wrapper">

  <p><a href="../assets/convolution/deconvolution.jpg" title="" target="_blank"></a></p>

  <p><img src="" alt="" /></p>

  <p>&lt;/a&gt;</p>

</div>

<p><a name="L4"></a>
## Deconvolution Arithmetic
In order to analyse deconvolution layer properties, we use the same simplified settings we used for convolution layer.</p>

<p><a name="L41"></a>
### No Zero Padding, Unit Strides, Transposed
* The example in Figure 2.2 shows convolution of \(3\) x \(3\) kernel on a \(4\) x \(4\) input with 
unitary stride and no padding (i.e., \(i = 4, k = 3, s = 1, p = 0\)). This produces output of size \(2\) x \(2\).<br />
* The transpose of this convolution is to obtain output of shape \(4\) x \(4\) when applied on a \(2\) x \(2\) input.
This can be achieved by directly convolving \(3\) x \(3\) kernel over \(2\) x \(2\) input padded with a \(2\) x \(2\) border of zeros
(i.e., \(i’= 2, k’ = k, s’ = s, p’ = 2\)). This is shown in Figure 2.5</p>

<div class="image-wrapper">

  <p><a href="../assets/convolution/deconv2.5.JPG" title="" target="_blank"></a></p>

  <p><img src="" alt="" /></p>

  <p>&lt;/a&gt;</p>

</div>

<p><strong>Relationship-7</strong>: A convolution described by \(s = 1, p = 0\), and \(k\) has an associated deconvolution described by \(k’ = k, s’ = s\)  and \(p’ = k - 1\)
and its output size is 
<script type="math/tex">o' = i'+ k - 1</script></p>

<p><strong><em>Proof</em></strong>: We know that, general form of convolution is defined as
<script type="math/tex">o = \lfloor \dfrac{i + 2p - k}{s} \rfloor + 1</script>
subsituting for \(s = 1, p = 0\), convolution is defined as
<script type="math/tex">o = i - k + 1</script>
But, we need \(o = i’, i = o’\), therefore
<script type="math/tex">i' = o' - k + 1</script>
<script type="math/tex">\implies o' = i' + k - 1</script></p>

<p><a name="L42"></a>
### Zero Padding, Unit Strides, Transposed
The transpose of zero padded convolution is equivalent to convolving an input padded with less zeros</p>

<p><strong>Relationship-8</strong>: A convolution described by \(s = 1, k\), and \(p\) has an associated deconvolution described by \(k’ = k, s’ = s\)  and \(p’ = k - p - 1\)
and its output size is 
<script type="math/tex">o' = i'+ (k - 1) - 2p</script></p>

<p>This is illustrated in Figure 2.6, for \(i = 5, k = 4\) and \(p = 2\)</p>

<div class="image-wrapper">

  <p><a href="../assets/convolution/deconv2.6.JPG" title="" target="_blank"></a></p>

  <p><img src="" alt="" /></p>

  <p>&lt;/a&gt;</p>

</div>

<p><a name="L43"></a>
### Half Padding, Transposed
Applying the same reasoning as before, transpose of half padded convolution is itself a half padded convolution.</p>

<p><strong>Relationship-9</strong>: A convolution described by \(k = 2n + 1\), \(n \in N\) and \(s = 1\) and \(p = \lfloor \dfrac{k}{2} \rfloor = n\)
has an associated transposed convolution described by \(k’ = k, s’ = s, p’ = p\) and its output size is
<script type="math/tex">o' = i'+ (k - 1) - 2p</script>
<script type="math/tex">o' = i'+ 2n - 2n</script>
<script type="math/tex">o' = i'</script></p>

<p>This is illustrated in Figure 2.7, for \(i = 5, k = 3\) and therefore \(p = 1\)</p>

<div class="image-wrapper">

  <p><a href="../assets/convolution/deconv2.7.JPG" title="" target="_blank"></a></p>

  <p><img src="" alt="" /></p>

  <p>&lt;/a&gt;</p>

</div>

<p><a name="L44"></a>
### Full Padding, Transposed
The equivalent of fully padded convolution is a non-padded convolution</p>

<p><strong>Relationship-10</strong>: A convolution described by \(s = 1, k\) and \(p = k - 1\)
has an associated transposed convolution described by \(k’ = k, s’ = s, p’ = 0\) and its output size is
<script type="math/tex">o' = i'+ (k - 1) - 2p</script>
<script type="math/tex">o' = i'- (k - 1)</script></p>

<p>This is illustrated in Figure 2.8, for \(i = 5, k = 3\) and therefore \(p = 2\)</p>

<div class="image-wrapper">

  <p><a href="../assets/convolution/deconv2.8.JPG" title="" target="_blank"></a></p>

  <p><img src="" alt="" /></p>

  <p>&lt;/a&gt;</p>

</div>

<p><a name="L45"></a>
### No Zero Padding, Non-Unit Strides, Transposed
Using the same kind of reasoning as before, we might expect that the transpose of a convolution with \(s &gt; 1\) involves 
equivalent convolution with \(s &lt; 1\). This is a valid intution and which is why transposed convolutions are also called as <em>fractionally
strided convolutions</em></p>

<p><strong>Relationship-11</strong>: A convolution described by \(p = 0, k\) and \(s\) and whose input
size is such that \(i - k\) is a multiple of \(s\), has an associated transposed
convolution described by \(\tilde{i}’\), \(k’ = k\), \(s’ = 1\) and \(p’ = k - 1\),
where \(\tilde{i}’\) is the size of the stretched input obtained by adding
\(s - 1\) zeros between each input unit, and its output size</p>

<script type="math/tex; mode=display">o' = s (i' - 1) + k</script>

<p>This is illustrated in Figure 2.9, for \(i = 5, k = 3\) and \(s = 2\)</p>

<div class="image-wrapper">

  <p><a href="../assets/convolution/deconv2.9.JPG" title="" target="_blank"></a></p>

  <p><img src="" alt="" /></p>

  <p>&lt;/a&gt;</p>

</div>

<p><a name="L46"></a>
### Zero Padding, Non-Unit Strides, Transposed</p>

<p><strong>Relationship-12</strong>: A convolution described by \(k\), \(s\) and \(p\) and whose
input size \(i\) is such that \(i + 2p - k\) is a multiple of \(s\) has an associated
transposed convolution described by \(\tilde{i}’\), \(k’ = k\), \(s’ = 1\) and
\(p’ = k - p - 1\), where \(\tilde{i}’\) is the size of the stretched input
obtained by adding \(s - 1\) zeros between each input unit, and its output size
is</p>

<p><script type="math/tex">o' = s (i' - 1) + k - 2p</script>
This is illustrated in Figure 2.10, for \(i = 5, k = 3, s = 2\) and \(p = 1\)</p>

<div class="image-wrapper">

  <p><a href="../assets/convolution/deconv2.10.JPG" title="" target="_blank"></a></p>

  <p><img src="" alt="" /></p>

  <p>&lt;/a&gt;</p>

</div>

<p>The constraint on the size of the input can be removed by introducing a new parameter \(a \in {0, \ldots, s - 1}\)</p>

<p><strong>Relationship-13</strong>: A convolution described by \(k\), \(s\) and \(p\) has an
associated transposed convolution described by \(a\), \(\tilde{i}’\), \(k’ = k\), \(s’ = 1\) 
and \(p’ = k - p - 1\), where \(\tilde{i}’\) is the size of the stretched
input obtained by adding \(s - 1\) zeros between each input unit, and \(a = (i + 2p - k) \mod s\)
represents the number of zeros added to the top and right edges
of the input, and its output size is</p>

<p><script type="math/tex">o' = s (i' - 1) + a + k - 2p</script>
This is illustrated in Figure 2.11, for \(i = 6, k = 3, s = 2\) and \(p = 1\)</p>

<div class="image-wrapper">

  <p><a href="../assets/convolution/deconv2.11.JPG" title="" target="_blank"></a></p>

  <p><img src="" alt="" /></p>

  <p>&lt;/a&gt;</p>

</div>

<p><a name="L46"></a></p>

<p><a name="L5"></a>
## Take Away</p>

<h3 id="formula-for-convolution">Formula for Convolution:</h3>
<p><script type="math/tex">o = \lfloor \dfrac{i + 2p - k}{s} \rfloor + 1</script></p>

<h3 id="formula-for-deconvolution">Formula for Deconvolution:</h3>
<p><script type="math/tex">o' = s (i' - 1) + a + k - 2p</script></p>

<p>where \( i \) : input size before convolution, \( k \) : kernel size, \( s \) : stride, \( p \) : zero padding, 
\(\lfloor \rfloor\): floor operation, \(o\) : output size after convolution,  \( i’ \) : input size before deconvolution
\(o’\) : output size after deconvolution, \(a \in {0, \ldots, s - 1}\)</p>

<p><a name="LR"></a>
## References
[1] <a href="https://arxiv.org/abs/1603.07285">A guide to convolution arithmetic for deep learning</a></p>


</div>
</div>
</div>


  <script src="/js/sp.js"></script>
  <script src="/vendor/js/jquery.min.js"></script>
  <script src="/vendor/js/bootstrap.min.js"></script>
  <script src="/vendor/js/anchor.min.js"></script>
  <script src="/vendor/js/jquery.toc.js"></script>
  <script type="text/javascript">
   try {
       var snowplowTracker = Snowplow.getTrackerUrl('joule.isr.cs.cmu.edu:8081');
       snowplowTracker.enableLinkTracking();
       snowplowTracker.trackPageView();
   } catch (err) {}

   $("#toc").toc({
       'headings': 'h2,h3'
   });
   anchors.add('h2,h3');
  </script>

</body>

</html>
